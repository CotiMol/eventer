.page-header
  %h1.pull-left
    %i.icon-bar-chart
    %span
      %a(href='/marketing') Marketing:
      = render partial: '/commons/time_segment_menu', locals: {top: '/marketing'}

.col-sm-12
  .box.bordered-box.red-border
    .box-header.red-background
      .title Funnel
    .box-content
      - @visitors_count = CampaignView.where("created_at >= ?", @since).where(element_viewed: "landing").count
      - @interested_count = CampaignView.where("created_at >= ?", @since).where(element_viewed: "registration_form").count
      - @registrants_count = Participant.where("created_at >= ?", @since).count
      - @sales_count = Participant.confirmed_or_attended.where("created_at >= ?", @since).count
      - @conversion_rate = (@visitors_count==0 )? 0 : @sales_count.to_f / @visitors_count.to_f * 100
      = "Conversion Rate: #{@conversion_rate.round(0)}%"
      .responsive-table
        %table{ style: "background-image:url(/images/funnel.png);background-repeat:no-repeat;background-position: center;", width: 400 }
          %tr
            %td{ align: "center" }
              %br
              %br
              %br
              %br
              %small
                Landing Page Views
              %br
              %strong
                = @visitors_count
          %tr
            %td{ align: "center" }
              %br
              %br
              %br
              %small
                Registration Form Views
              %br
              %strong
                = @interested_count
          %tr
            %td{ align: "center" }
              %br
              %small
                Registros
              %br
              %strong
                = @registrants_count
          %tr
            %td{ align: "center" }
              %br
              %small
                Confirmados
              %br
              %strong
                = @sales_count
              %br
              %br
              %br

      -#%img{ src: "/images/funnel.png" }

.col-sm-12
  .box.bordered-box.red-border
    .box-header.red-background
      .title Campañas
    .box-content.box-no-padding
      .responsive-table
        .scrollable-area
          %table.table.table-hover.table-striped.data-table
            %thead
              %tr
                %td
                  %strong Nombre
                %td
                  %strong Landing Page Views
                %td
                  %strong Registration Form Views
                %td
                  %strong Registros
                %td
                  %strong Confirmados
                %td
                  %strong Fecha Inicio
                %td
                  %strong Última Acción (View o Registro)
            %tbody
              - @camapigns.each do |campaign|
                %tr
                  %td
                    %a{ href: "/marketing/campaigns/#{campaign.id}/#{@time_segment}" }
                      = campaign.display_name
                  %td= CampaignView.where(campaign_id: campaign.id).where("created_at >= ?", @since).where(element_viewed: "landing").count
                  %td= CampaignView.where(campaign_id: campaign.id).where("created_at >= ?", @since).where(element_viewed: "registration_form").count
                  %td= Participant.where(campaign_id: campaign.id).where("created_at >= ?", @since).count
                  %td= Participant.confirmed_or_attended.where(campaign_id: campaign.id).where("created_at >= ?", @since).count
                  %td
                    = campaign.created_at
                  %td
                    = campaign.updated_at
